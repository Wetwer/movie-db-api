<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<div class="alert alert-success" th:if="${param.uploaded}">
    Movie Uploaded
</div>
<div class="alert alert-success" th:if="${param.deleted}">
    Movie Deleted <span th:text="${param.deleted}"></span>
</div>
<div class="alert alert-success" th:if="${param.scan}">
    Scan Complete
</div>
<div class="alert alert-success" th:if="${param.added}">
    Movie Added
</div>
<div class="alert alert-danger" th:if="${param.cancel}">
    Movie Upload Canceled
</div>
<div class="alert alert-danger" th:if="${param.exists}">
    Movie allready exists
</div>

<h1>Upload Movie</h1>
<form action="/upload/movie" id="uploadMovie" method="post" enctype="multipart/form-data">
    <div class="custom-file">
        <input class="custom-file-input" id="movie" name="movie" required type="file">
        <label class="custom-file-label" for="movie">Choose movie...</label>
    </div>
    <br>
    <br>
    <button id="submitUpload" type="submit" class="btn btn-primary">Upload</button>
</form>
<br>
<form action="/upload/scan" method="post">
    <button type="submit" class="btn btn-secondary"><i class="fas fa-sync-alt"></i> Scan</button>
</form>
<br>
<div class="card">
    <div class="card-header">Uploaded Files</div>
    <div class="card-body">
        <ul class="list-group">
            <li th:each="file : ${files}" class="list-group-item">
                <b th:text="${file.filename}"></b>
                <span th:text="${filesize.getFileSize(file.size)} + ' MB'"></span>
                <div class="float-right">
                    <span th:text="${#dates.format(file.timestamp, 'dd.MM.yyyy HH:mm')}"></span>
                    <th:block th:if="${file.completed}">
                        <div style="display: inline">
                            <a class="btn btn-secondary" data-toggle="modal" href="#" style="display: inline"
                               th:data-target="'#editFile' + ${file.id}">
                                <i class="far fa-edit"></i>
                            </a>
                        </div>
                        <form th:action="'/upload/accept/' + ${file.id}" method="post" style="display: inline">
                            <button type="submit" class="btn btn-success"><i class="fas fa-check"></i></button>
                        </form>
                        <form th:action="'/upload/delete/' + ${file.id}" method="post" style="display: inline">
                            <button type="submit" class="btn btn-danger"><i class="fas fa-times"></i></button>
                        </form>
                    </th:block>
                    <th:block th:if="${!file.completed}">
                        <button class="btn btn-secondary" disabled><i class="fas fa-cloud-upload-alt"></i></button>
                    </th:block>
                </div>
            </li>
            <li class="list-group-item list-group-item-secondary" th:if="${files.isEmpty()}">
                No Movies in Upload Folder
            </li>
        </ul>
    </div>
</div>

<form>

</form>

<div aria-hidden="true" aria-labelledby="edit" class="modal fade" role="dialog" tabindex="-1"
     th:each="file : ${files}" th:id="'editFile' + ${file.id}">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="request">Edit File</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form method="post" th:action="'/upload/edit/' + ${file.id}">
                <div class="modal-body">
                    <input class="form-control" name="name" placeholder="File Name" required th:value="${file.filename}"
                           type="text">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                    <button class="btn btn-primary" type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
<br>
<a class="btn btn-primary" href="/settings">Back</a>
<script>
    (function ($) {
        $("#submitUpload").on("click", function (e) {
            const formData = new FormData(document.forms["uploadMovie"]);
            $.ajax({
                url: '/upload/movie',
                type: 'POST',
                data: formData,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function (data) {
                },
                error: function (data) {
                }
            });
            return false;
        });
    })(jQuery);
</script>
